<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epoch TxSign</title>
    <script src="https://unpkg.com/algosdk@latest"></script>
    <script src="./js/buffer.js"></script>
    <script src="./js/myalgo.js"></script>
    <script src ="./js/scripts.js"></script>

    <style>
        body{
            text-align: center;
            height: 100vh; /* Magic here */
                display: flex;
                justify-content: center;
                align-items: center;
        }
        .childDiv{
            border-width:1px;
            border-color: #4ABCD9;
            border-style: solid;
            width:70%;
            height:90%;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            /* justify-content: center; */
            align-items: center;
                }

            button{
                display:block;
                height:40px;
                width:200px;
                margin-top: 10px;
                border-radius: 10px;
                border-width: 0px;
                background-color: #4ABCD9;
                color: white;
                font-weight: bold;
            }
            .actionContainer{
                 width:100%;
                 text-align: center;
                 display: flex;
                 align-items:center ;
                 flex-direction: column;
                 margin-top: 30px;
            }
    </style>
</head>
<body>
    <div class="childDiv">

        <div class="actionContainer" id="connect">
            <button >Connect To myalgowallet</button>
        </div>
        <div class="actionContainer">
            <p id ="epochNftDesc1">Json Decription of transaction to Sign</p>
            <button id ="showEpochNft1Trans">Show NFT Edition 1 trans</button>
            <button id ="createEpochNft1">Create Epoch NFT Edition 1</button>
            <button id ="createEpochNft1">Clawback Epoch NFT Edition 1</button>
        </div>
        <div class="actionContainer">
            <p>Json Decription of transaction to Sign</p>
            <button id ="createEpochNft2">Create Epoch NFT Edition 2</button>
        </div>
        <div class="actionContainer">
            <p>Json Decription of transaction to Sign</p>
            <button id ="createEpochNft3">Create Epoch NFT Edition 3</button>
        </div>
        <div class="actionContainer">
            <p>Json Decription of transaction to Sign</p>
            <button id ="createEpochNft4">Create Epoch NFT Edition 4</button>
        </div>
        <div class="actionContainer">
            <p>Json Decription of transaction to Sign</p>
            <button id ="createEpochNft5">Create Epoch NFT Edition 5</button>
        </div>
        <div class="actionContainer">
            <p>Json Decription of transaction to Sign</p>
            <button id ="createEpochNft6">Create Epoch NFT Edition 6</button>
        </div>
        <div class="actionContainer">
            <p>Json Decription of transaction to Sign</p>
            <button id ="createEpochNft7">Create Epoch NFT Edition 7</button>
        </div>
        <div class="actionContainer">
            <p>Json Decription of transaction to Sign</p>
            <button id ="createEpochNft8">Create Epoch NFT Edition 8</button>
        </div>
        <div class="actionContainer">
            <p>Json Decription of transaction to Sign</p>
            <button id ="createEpochNft9">Create Epoch NFT Edition 9</button>
        </div>
        <div class="actionContainer">
            <p>Json Decription of transaction to Sign</p>
            <button id ="createEpochNft10">Create Epoch NFT Edition 10</button>
        </div>
        <div class="actionContainer">
            <p>Json Decription of transaction to Sign</p>
            <button id ="createEpochNft11">Create Epoch NFT Edition 11</button>
        </div>
        <div class="actionContainer">
            <p>Json Decription of transaction to Sign</p>
            <button id ="createEpochNft12">Create Epoch NFT Edition 12</button>
        </div>
    </div>

    <!-- <div>
        <button id="connect">Connect</button>
    </div>

    <div>
        <button id="optIn">Opt Into NFT</button>
    </div> -->
   
    

    <script>
        window.addEventListener('load',async function(){
        let epochNftDesc1 = document.getElementById("epochNftDesc1");
        let epochNftBut1 = document.getElementById("createEpochNft1");
        let showNft1but = document.getElementById("showEpochNft1Trans");
        let epochNftBut2 = document.getElementById("createEpochNft2");
        let epochNftBut3 = document.getElementById("createEpochNft3");
        let epochNftBut4 = document.getElementById("createEpochNft4");
        let epochNftBut5 = document.getElementById("createEpochNft5");
        let epochNftBut6 = document.getElementById("createEpochNft6");
        let epochNftBut7 = document.getElementById("createEpochNft7");
        let epochNftBut8 = document.getElementById("createEpochNft8");
        let epochNftBut9 = document.getElementById("createEpochNft9");
        let epochNftBut10 = document.getElementById("createEpochNft10");
        let epochNftBut11 = document.getElementById("createEpochNft11");
        let epochNftBut12 = document.getElementById("createEpochNft12");
        
        // let optInButton = document.getElementById("optIn");
        let connectButton = document.getElementById("connect");
      
        const token = { 'X-API-Key':'ADRySlL0NK5trzqZGAE3q1xxIqlQdSfk1nbHxTNe'};
        const server = "https://testnet-algorand.api.purestake.io/ps2";
        const port = '';
        const client = new algosdk.Algodv2(token, server, port);
        var compiledApprovalProgram = await compileFreeportContract(client);
        let compiledClearProgram = await compileClearProgram(client);
        let approvalProgram =  new Uint8Array(Buffer.from(compiledApprovalProgram.result,"base64"));
        let clearProgram =  new Uint8Array(Buffer.from(compiledClearProgram.result,"base64"));
        let params = await client.getTransactionParams().do();
        console.log(approvalProgram);
        console.log(clearProgram);
      
       
        let sender = "FNYZLBWJTCIMWKZCE4Q6JHQHLD3XHGVDZTD5YXRYVR4CDKZY2NHG7RA65I";
        // console.log(createEpochNft("name",params,approvalProgram,clearProgram,1000000,sender))
        connectButton.addEventListener('click',async function(){
           let addresses = await  myalgoConnect.connect();
            sender = addresses[0].address;
            console.log(sender);
        });
        let epochtx1 = createEpochNft("name",params,approvalProgram,clearProgram,1000000,sender);
        let epochtx2 = createEpochNft("name",params,approvalProgram,clearProgram,1000000,sender);
        let epochtx3 = createEpochNft("name",params,approvalProgram,clearProgram,1000000,sender);
        let epochtx4 = createEpochNft("name",params,approvalProgram,clearProgram,1000000,sender);
        let epochtx5 = createEpochNft("name",params,approvalProgram,clearProgram,1000000,sender);
        let epochtx6 = createEpochNft("name",params,approvalProgram,clearProgram,1000000,sender);
        let epochtx7 = createEpochNft("name",params,approvalProgram,clearProgram,1000000,sender);
        let epochtx8 = createEpochNft("name",params,approvalProgram,clearProgram,1000000,sender);
        let epochtx9 = createEpochNft("name",params,approvalProgram,clearProgram,1000000,sender);
        let epochtx10 = createEpochNft("name",params,approvalProgram,clearProgram,1000000,sender);
        let epochtx11 = createEpochNft("name",params,approvalProgram,clearProgram,1000000,sender);
        let epochtx12 = createEpochNft("name",params,approvalProgram,clearProgram,1000000,sender);
        let epochtx13 = createEpochNft("name",params,approvalProgram,clearProgram,1000000,sender);
         
        epochNftBut1.addEventListener('click',async function(){       // alert("epochNft1");
            let confirmedTx = await createAssetTxn([...epochtx1]);
        });


        epochNftBut2.addEventListener('click',async function(){       // alert("epochNft1");
       
        });


        epochNftBut3.addEventListener('click',async function(){       // alert("epochNft1");
       
        });


        epochNftBut4.addEventListener('click',async function(){       // alert("epochNft1");
       
        });

        epochNftBut5.addEventListener('click',async function(){       // alert("epochNft1");
       
        });


        epochNftBut6.addEventListener('click',async function(){       // alert("epochNft1");
       
        });


        epochNftBut7.addEventListener('click',async function(){       // alert("epochNft1");
       
        });


        epochNftBut8.addEventListener('click',async function(){       // alert("epochNft1");
       
        });



        epochNftBut9.addEventListener('click',async function(){       // alert("epochNft1");
       
        });



        epochNftBut10.addEventListener('click',async function(){       // alert("epochNft1");
       
        });




        epochNftBut11.addEventListener('click',async function(){       // alert("epochNft1");
       
        });



        epochNftBut12.addEventListener('click',async function(){       // alert("epochNft1");
       
        });



        epochNftBut1.addEventListener('click',async function(){       // alert("epochNft1");
       
        });



        epochNftBut1.addEventListener('click',async function(){       // alert("epochNft1");
       
        });



        epochNftBut1.addEventListener('click',async function(){       // alert("epochNft1");
       
        });


        // optInButton.addEventListener('click',async function(){
        //     let addressToOptInto = await optInEpochNft(sender,16405423);
        //     console.log(addressToOptInto);
        // });


        async function createAssetTxn(epochTx){

return new Promise(async(resolve,reject)=>{
    let params ={};
    try{
     params = await client.getTransactionParams().do();
    }catch(error){
       reject(error); 
    }
 
    let epoch1Str = JSON.stringify(epochTx);
      let signedTxns = {}
      try{
        signedTxns =   await  myalgoConnect.signTransaction(epochTx);
      }catch(error){
        reject(error);
      }
      console.log(signedTxns);
      let blobs = signedTxns.map((el,index)=>{
              return el.blob
          });
    try{
     let   txTest={}
     try{ 
         txTest = (await client.sendRawTransaction(blobs).do());
         console.log(txTest);
         resolve(txTest)
     }catch(error){
         reject(error)
     }


  
      }catch(error){
        console.error("Error ocurred ", error);
        
                reject(error);
                return;
        }

});

}


        function formatJson(jsonString){
            f = {
            brace: 0
        }; // AN OBJECT FOR TRACKING INCREMENTS/DECREMENTS,
           // IN PARTICULAR CURLY BRACES (OTHER PROPERTIES COULD BE ADDED)
     

            let regstr = jsonString.replace(/({|}[,]*|[^{}:]+:[^{}:,]*[,{]*)/g, function (m, p1) {
                            var rtnFn = function() {
                                    return '<div style="text-indent: ' + (f['brace'] * 20) + 'px;">' + p1 + '</div>';
                                },
                                rtnStr = 0;
                                if (p1.lastIndexOf('{') === (p1.length - 1)) {
                                    rtnStr = rtnFn();
                                    f['brace'] += 1;
                                } else if (p1.indexOf('}') === 0) {
                                    f['brace'] -= 1;
                                    rtnStr = rtnFn();
                                } else {
                                    rtnStr = rtnFn();
                                }
                                return rtnStr;
                            });
            return regstr;
        }
        });

       







      
          /*
          Peter Conects to myalgoconnect
          He creates the assets editions 1 to 13 of his asset
          He claws back each asset just immediately after creating them

          
          */
    </script>

  
</body>
</html>